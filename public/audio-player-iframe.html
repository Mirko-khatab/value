<!DOCTYPE html>
<html>
  <head>
    <title>Audio Player Iframe</title>
    <style>
      body {
        margin: 0;
        padding: 0;
        background: transparent;
        overflow: hidden;
      }
      audio {
        display: none;
      }
    </style>
  </head>
  <body>
    <audio id="audio" loop preload="auto"></audio>

    <script>
      const audio = document.getElementById("audio");
      let isPlaying = false;

      // Listen for messages from parent
      window.addEventListener("message", async (event) => {
        const { action, audioUrl, volume } = event.data;

        console.log("ðŸŽµ Iframe received message:", action, audioUrl);

        switch (action) {
          case "LOAD_AUDIO":
            if (audioUrl) {
              audio.src = audioUrl;
              audio.volume = volume || 0.7;
              console.log("ðŸŽµ Audio loaded in iframe:", audioUrl);
            }
            break;

          case "PLAY_AUDIO":
            try {
              // Iframes sometimes have different autoplay policies
              await audio.play();
              isPlaying = true;
              console.log("âœ… Audio playing in iframe!");

              // Notify parent of success
              window.parent.postMessage(
                {
                  type: "AUDIO_STARTED",
                  success: true,
                },
                "*"
              );
            } catch (error) {
              console.log("âŒ Iframe audio blocked:", error.message);
              window.parent.postMessage(
                {
                  type: "AUDIO_BLOCKED",
                  success: false,
                  error: error.message,
                },
                "*"
              );
            }
            break;

          case "STOP_AUDIO":
            audio.pause();
            audio.currentTime = 0;
            isPlaying = false;
            console.log("â¹ï¸ Audio stopped in iframe");
            break;

          case "SET_VOLUME":
            audio.volume = volume || 0.7;
            console.log("ðŸ”Š Volume set to:", audio.volume);
            break;

          case "MUTE":
            audio.muted = true;
            console.log("ðŸ”‡ Audio muted in iframe");
            break;

          case "UNMUTE":
            audio.muted = false;
            console.log("ðŸ”Š Audio unmuted in iframe");
            break;
        }
      });

      // Auto-attempt playback on load (sometimes works in iframes)
      window.addEventListener("load", () => {
        console.log("ðŸŽµ Iframe loaded - ready for audio commands");

        // Notify parent that iframe is ready
        window.parent.postMessage(
          {
            type: "IFRAME_READY",
          },
          "*"
        );
      });

      // Monitor audio events
      audio.addEventListener("loadeddata", () => {
        console.log("âœ… Audio data loaded in iframe");
        window.parent.postMessage(
          {
            type: "AUDIO_LOADED",
            duration: audio.duration,
          },
          "*"
        );
      });

      audio.addEventListener("error", (e) => {
        console.error("âŒ Audio error in iframe:", e);
        window.parent.postMessage(
          {
            type: "AUDIO_ERROR",
            error: e.message || "Unknown error",
          },
          "*"
        );
      });

      audio.addEventListener("ended", () => {
        if (audio.loop) {
          audio.currentTime = 0;
          audio.play().catch(console.error);
        }
      });
    </script>
  </body>
</html>
